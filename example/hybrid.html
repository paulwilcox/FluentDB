<body>

    <div id='result'></div>   

    <script type='module'> 

        import { sampleDataSets, sampleIdb } from "./data.js";
        import { $$ } from "../src/oneQuery.js";

        $$({
            sam: $$.db(sampleIdb, 'idb'),
            o: sam => 'orders',
            p: sam => 'products',
            c: sampleDataSets.customers
        })
        .filter(o => o.product != 123456) 
        .join( 
            $$.inner( (o,p) => o.product == p.id ),
            $$.left( (o,c) => o.customer == c.id )
        )
        .orderBy((o,p) => o.product)
        .groupBy(o => o.product)
        .fold('f', {
            product:        $$.key(o => o.product),
            revenue:        $$.sum(p => p.price), 
            transactions:   $$.count(p => p.price),
            avgRating:      $$.avg(o => o.rating),
            stdRating:      $$.std(o => 
                                o.rating,
                                x => Math.round(x * 100) / 100
                            ),
            corSR:          $$.cor(
                                o => [o.speed, o.rating], 
                                x => Math.round(x * 100) / 100
                            )
        })
        .print(f => f, '#result', 'oneQuery Result');

    </script>

</body>