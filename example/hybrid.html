<body>

    <div id='result'></div>   

    <script type='module'> 

        import { sampleDataSets, sampleIdb } from "./data.js";
        import { oneQuery } from "../src/oneQuery.js";

        new oneQuery(sampleIdb, 'idb')
        .from({
            o: 'orders',
            p: 'products',
            c: sampleDataSets.customers
        })
        .filter(o => o.product != 123456) 
        .join( 
            { inner: (o,p) => o.product == p.id },
            { left: (o,c) => o.customer == c.id }
        )
        .orderBy((o,p) => o.product)
        .groupBy(o => o.product)
        .fold('f', {
            product:        oneQuery.key(o => o.product),
            revenue:        oneQuery.sum(p => p.price), 
            transactions:   oneQuery.count(p => p.price),
            avgRating:      oneQuery.avg(o => o.rating),
            stdRating:      oneQuery.std(o => 
                                o.rating,
                                x => Math.round(x * 100) / 100
                            ),
            corSR:          oneQuery.cor(
                                o => [o.speed, o.rating], 
                                x => Math.round(x * 100) / 100
                            )
        })
        .print(f => f, '#result', 'oneQuery Result');

    </script>

</body>