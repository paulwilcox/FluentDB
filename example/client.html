<div id='printDiv'></div>

<script type='module'>

    import $$ from '../dist/FluentDB.client.js';
    import sample from '../node_modules/sampledb/dist/sampledb.client.js'; 

    let result = $$({
        o: sample.orders,
        p: sample.products,
        c: sample.customers,
        pc: sample.potentialCustomers,
        s: sample.shoplifters 
    })
    .print(o => o, 'o: before')
    .merge((c,pc) => c.id == pc.id, 'both left') // left join
    .merge((c,s) => c.id == s.id, 'null left') // not exists
    .merge((o,c) => o.customer == c.id, 'both both') // full join
    .group(o => o.customer) 
    .reduce(o => ({
        customerId: $$.first(o.customer || 'n/a'), 
        customer: $$.first(o.fullname || 'No Name'),
        orders: $$.count(o.id), 
        price: $$.avg(o.price),
        speed: $$.avg(o.speed),
        rating: $$.avg(o.rating),
        correlation: $$.cor(o.speed, o.rating)
    }))
    .print(o => o, 'o: after')
    .catch(err => console.log(err))
    .execute(o => o);

    
/*
    fetch('getMongo')
    .then(response => response.json())
    .then(json => console.log(JSON.stringify(json)))
    .catch(e => console.log({e}));
*/

</script>

