<div id='printDiv'></div>

<script type='module'>

    import $$ from "../dist/FluentDB.client.js";
    import sample from '../node_modules/sampledb/dist/sampledb.client.js'; 
/*
    let results = [];
    let crosses = [];    
    let working = [];
    let func = (x,y,z) => ({x,y,z});
    let cbIXs = [0,1,2];
    
    let b = [];
    b[0] = { x: 'x', y: 'y' };
    //b[1] = { x: 'ex', y: 'why' };
    
    let bucketSet = [
        b,
        [ { a: 'a', b: 'b' }, { a: 'eigh', b: 'bee' }],
        [ { o: 1, t: 2 }, { o: 0, t: 10 } ]
    ];

    for (let row of bucketSet[cbIXs.shift()]) {
        if (row === undefined)
            continue;
        crosses.push([row]);
    }

    for (let cbIX of cbIXs) {
        let bucket = bucketSet[cbIX];
        for (let cross of crosses) 
        for (let row of bucket) {
            if(row === undefined) 
                continue;
            working.push([...cross, row]);
        }
        crosses = working;
        working = [];
    }

    for (let cross of crosses) {
        let mapped = func(...cross);
        if (mapped === undefined)
            continue;
        if (!Array.isArray(mapped)) {
            results.push(mapped);
            continue;
        }
        for(entry of mapped)
            if (entry !== undefined)
                results.push(entry);
    }

    console.log({results})

throw 'early';
*/

    let result = $$({
        o: sample.orders,
        p: sample.products,
        c: sample.customers,
        pc: sample.potentialCustomers,
        s: sample.shoplifters 
    })
    .merge2((o,p) => o.product == p.id, 'both null') // inner join
    .merge2((o,c) => o.customer == c.id, 'both left') // left join
    //.merge2((o,s) => o.customer == s.id, 'null left') // not exists, or delete
    /*.group(o => o.customer) 
    .reduce(o => ({
        customerId: $$.first(o.customer || 'n/a'), 
        customer: $$.first(o.fullname || 'No Name'),
        orders: $$.count(o.id), 
        price: $$.avg(o.price),
        speed: $$.avg(o.speed),
        rating: $$.avg(o.rating),
        correlation: $$.cor(o.speed, o.rating)
    }))
    .catch(err => console.log(err))*/
    .execute(o => o);

    console.log(result);
    
/*
    fetch('getMongo')
    .then(response => response.json())
    .then(json => console.log(JSON.stringify(json)))
    .catch(e => console.log({e}));
*/

</script>

