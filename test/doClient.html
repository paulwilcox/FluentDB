<script type='module'>

    import sample from '../node_modules/sampledb/dist/sampledb.client.js';
    import sampleIdb from '../node_modules/sampledb/dist/sampledb.idb.js';
    import $$ from '../dist/FluentDB.client.js';
    import _tests from './tests.js';

    let tests = (testName, fdbCreator) =>
        new _tests(__seriToRun__, __testsToRun__)
        .run(testName, fdbCreator);

    sampleIdb('SampleDB', true) // resets sampleData in IndexedDB
    .then(() => Promise.all([

        tests('client', () => $$({ 
            o: sample.orders,
            c: sample.customers,
            p: sample.products,
            pc: sample.potentialCustomers,
            s: sample.shoplifters
        })),

        tests('idb', () => $$({ 
            sam: $$.idb('SampleDB'),
            o: sam => 'orders',
            c: sam => 'customers',
            p: sam => 'products',
            pc: sam => 'potentialCustomers',
            s: sam => 'shoplifters'
        })),

        tests('client/idb', () => $$({
            sam: $$.idb('SampleDB'),
            o: sample.orders,
            c: sample.customers,
            p: sam => 'products',
            pc: sam => 'potentialCustomers',
            s: sam => 'shoplifters'
        })),

        tests('idb/client', () => $$({
            sam: $$.idb('SampleDB'),
            o: sam => 'orders',
            c: sam => 'customers',
            p: sample.products,
            pc: sample.potentialCustomers,
            s: sample.shoplifters 
        }))

    ]))
    .then(seri => {
        for(let series of seri) 
            for(let test of series)
                console.log(`test ${test.seriesName}.${test.name} ${test.passStatus}`);
    })
    .then(() => console.log('done'));

</script>