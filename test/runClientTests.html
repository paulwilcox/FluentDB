<script type='module'>

    import sample from './dist/sampleData.client.js';
    import sampleIdb from './dist/sampleData.idb.js';
    import $$ from './dist/FluentDB.client.next.js';
    import tests from './test/tests.js';

    // TODO: I think I have to rebuild sampleIDB after every
    // tests because the IDB database changes state after
    // every merge.
    sampleIdb('sampleData', true) // resets sampleData in IndexedDB
    .then(() => Promise.all([

        tests('client', () => $$({ 
            o: sample.orders,
            p: sample.products,
            c: sample.customers,
            pc: sample.potentialCustomers,
            s: sample.shoplifters
        })),

        tests('idb', () => $$({ 
            sam: $$.idb('sampleData'),
            o: sam => 'orders',
            p: sam => 'products',
            c: sam => 'customers',
            pc: sam => 'potentialCustomers',
            s: sam => 'shoplifters'
        })),

        tests('idbHybridLeft', () => $$({
            sam: $$.idb('sampleData'),
            o: sample.orders,
            p: sam => 'products',
            c: sample.customers,
            pc: sam => 'potentialCustomers',
            s: sam => 'shoplifters'
        })),

        tests('idbHybridRight', () => $$({
            sam: $$.idb('sampleData'),
            o: sam => 'orders',
            p: sample.products,
            c: sam => 'customers',
            pc: sample.potentialCustomers,
            s: sample.shoplifters 
        }))

    ]))
    .then(seri => {
        console.log(seri)
        for(let series of seri) 
            for(let test of series)
                console.log(`test ${test.seriesName}.${test.name} ${test.passStatus}`);
    })
    .then(() => console.log('done:client.tests'));

</script>